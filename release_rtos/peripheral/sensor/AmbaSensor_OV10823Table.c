#include <AmbaSSP.h>

#include "AmbaDSP.h"
#include "AmbaSensor.h"
#include "AmbaSensor_OV10823.h"

/*-----------------------------------------------------------------------------------------------*\
 * Sensor Device Information
\*-----------------------------------------------------------------------------------------------*/
const AMBA_SENSOR_DEVICE_INFO_s OV10823DeviceInfo = {
    .UnitCellWidth          = 1.4,
    .UnitCellHeight         = 1.4,
    .NumTotalPixelCols      = 4352,
    .NumTotalPixelRows      = 2464,
    .NumEffectivePixelCols  = 4336,
    .NumEffectivePixelRows  = 2440,
    .MinAnalogGainFactor    = 1.0,
    .MaxAnalogGainFactor    = 15.9375,
    .MinDigitalGainFactor   = 1.0,
    .MaxDigitalGainFactor   = 3.9990234375,

    .FrameRateCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_VBLANK,
        .FirstReflectedFrame    = 2,
        .FirstBadFrame          = 1,
        .NumBadFrames           = 1
    },
    .ShutterSpeedCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_VBLANK,
        .FirstReflectedFrame    = 1,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .AnalogGainCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_VBLANK,
        .FirstReflectedFrame    = 1,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
    .DigitalGainCtrlInfo = {
        .CommunicationTime      = AMBA_SENSOR_COMMUNICATION_AT_VBLANK,
        .FirstReflectedFrame    = 0,
        .FirstBadFrame          = 0,
        .NumBadFrames           = 0
    },
};

/*-----------------------------------------------------------------------------------------------*\
 * Sensor register settings of each readout modes
\*-----------------------------------------------------------------------------------------------*/
OV10823_REG_s OV10823RegTable[OV10823_NUM_READOUT_MODE_REG] = {
    /*        NTSC              PAL              */
    {0x3080, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x3083, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x3084, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x308b, {0x05, 0x05, 0x05, 0x05, 0x05, 0x05}},
    {0x308d, {0xae, 0xae, 0xae, 0xae, 0xae, 0xae}},
    {0x308e, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x308f, {0x09, 0x09, 0x09, 0x09, 0x09, 0x09}},
    {0x3011, {0xd0, 0xd0, 0xd0, 0xd0, 0xd0, 0xd0}},
    {0x3012, {0x41, 0x41, 0x41, 0x41, 0x41, 0x41}},
    {0x3031, {0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c}},
    {0x3032, {0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0}},
    {0x3503, {0x07, 0x07, 0x07, 0x07, 0x07, 0x07}},
    {0x3603, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x3641, {0x83, 0x83, 0x83, 0x83, 0x83, 0x83}},
    {0x3643, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x3645, {0x41, 0x41, 0x41, 0x41, 0x41, 0x41}},
    {0x3646, {0x83, 0x83, 0x83, 0x83, 0x83, 0x83}},
    {0x3648, {0x0d, 0x0d, 0x0d, 0x0d, 0x0d, 0x0d}},
    {0x3649, {0x86, 0x86, 0x86, 0x86, 0x86, 0x86}},
    {0x3653, {0x37, 0x37, 0x37, 0x37, 0x37, 0x37}},
    {0x3658, {0x8b, 0x8b, 0x8b, 0x8b, 0x8b, 0x8b}},
    {0x3659, {0x87, 0x87, 0x87, 0x87, 0x87, 0x87}},
    {0x365c, {0x5a, 0x5a, 0x5a, 0x5a, 0x5a, 0x5a}},
    {0x3660, {0x82, 0x82, 0x82, 0x82, 0x82, 0x82}},
    {0x3705, {0x22, 0x22, 0x22, 0x22, 0x22, 0x22}},
    {0x3719, {0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c}},
    {0x371b, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x371c, {0x80, 0x80, 0x80, 0x80, 0x80, 0x80}},
    {0x371e, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x371f, {0x20, 0x20, 0x20, 0x20, 0x20, 0x20}},
    {0x3720, {0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0}},
    {0x3721, {0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0}},
    {0x3723, {0x78, 0x78, 0x78, 0x78, 0x78, 0x78}},
    {0x372a, {0x08, 0x08, 0x08, 0x08, 0x08, 0x08}},
    {0x372c, {0x11, 0x11, 0x11, 0x11, 0x11, 0x11}},
    {0x373c, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x3749, {0xd7, 0xd7, 0xd7, 0xd7, 0xd7, 0xd7}},
    {0x374a, {0x8c, 0x8c, 0x8c, 0x8c, 0x8c, 0x8c}},
    {0x3752, {0x80, 0x80, 0x80, 0x80, 0x80, 0x80}},
    {0x3821, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x382e, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x3901, {0x80, 0x80, 0x80, 0x80, 0x80, 0x80}},
    {0x3902, {0xc6, 0xc6, 0xc6, 0xc6, 0xc6, 0xc6}},
    {0x4004, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x4005, {0x20, 0x20, 0x20, 0x20, 0x20, 0x20}},
    {0x400d, {0x10, 0x10, 0x10, 0x10, 0x10, 0x10}},
    {0x401b, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x401d, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x401f, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x4020, {0x01, 0x01, 0x01, 0x01, 0x01, 0x01}},
    {0x4022, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x4024, {0x0e, 0x0e, 0x0e, 0x0e, 0x0e, 0x0e}},
    {0x4025, {0x10, 0x10, 0x10, 0x10, 0x10, 0x10}},
    {0x4026, {0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f}},
    {0x4027, {0x9f, 0x9f, 0x9f, 0x9f, 0x9f, 0x9f}},
    {0x4028, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x4029, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x402d, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x402f, {0x08, 0x08, 0x08, 0x08, 0x08, 0x08}},
    {0x4602, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x4810, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x4811, {0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f}},
    {0x4819, {0xa0, 0xa0, 0xa0, 0xa0, 0xa0, 0xa0}},
    {0x481b, {0x35, 0x35, 0x35, 0x35, 0x35, 0x35}},
    {0x481f, {0x30, 0x30, 0x30, 0x30, 0x30, 0x30}},
    {0x4823, {0x35, 0x35, 0x35, 0x35, 0x35, 0x35}},
    {0x4d00, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x4d01, {0x71, 0x71, 0x71, 0x71, 0x71, 0x71}},
    {0x4d03, {0xf5, 0xf5, 0xf5, 0xf5, 0xf5, 0xf5}},
    {0x4d04, {0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c}},
    {0x4d05, {0xcc, 0xcc, 0xcc, 0xcc, 0xcc, 0xcc}},
    {0x4d0b, {0x01, 0x01, 0x01, 0x01, 0x01, 0x01}},
    {0x5002, {0x08, 0x08, 0x08, 0x08, 0x08, 0x08}},
    {0x5a04, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x5a06, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x5b01, {0x10, 0x10, 0x10, 0x10, 0x10, 0x10}},
    {0x5b05, {0xec, 0xec, 0xec, 0xec, 0xec, 0xec}},
    {0x5b09, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x5e10, {0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c}},
    {0x3082, {0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c}},
    {0x3092, {0x04, 0x04, 0x04, 0x04, 0x04, 0x04}},
    {0x300d, {0x22, 0x22, 0x22, 0x22, 0x22, 0x22}},
    {0x301b, {0xb4, 0xb4, 0xb4, 0xb4, 0xb4, 0xb4}},
    {0x3033, {0x5c, 0x5c, 0x5c, 0x5c, 0x5c, 0x5c}},
    {0x3034, {0x91, 0x91, 0x91, 0x91, 0x91, 0x91}},
    {0x3035, {0x6e, 0x6e, 0x6e, 0x6e, 0x6e, 0x6e}},
    {0x3036, {0xa4, 0xa4, 0xa4, 0xa4, 0xa4, 0xa4}},
    {0x3037, {0x6e, 0x6e, 0x6e, 0x6e, 0x6e, 0x6e}},
    {0x3038, {0xa4, 0xa4, 0xa4, 0xa4, 0xa4, 0xa4}},
    {0x3642, {0x35, 0x35, 0x35, 0x35, 0x35, 0x35}},
    {0x3663, {0x11, 0x11, 0x01, 0x11, 0x11, 0x01}},
    {0x3700, {0x44, 0x44, 0x44, 0x44, 0x44, 0x44}},
    {0x3701, {0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c}},
    {0x3702, {0x90, 0x90, 0x90, 0x90, 0x90, 0x90}},
    {0x3703, {0x60, 0x60, 0x60, 0x60, 0x60, 0x60}},
    {0x3704, {0x20, 0x20, 0x20, 0x20, 0x20, 0x20}},
    {0x3706, {0x18, 0x18, 0x18, 0x18, 0x18, 0x18}},
    {0x3707, {0x5d, 0x5d, 0x5d, 0x5d, 0x5d, 0x5d}},
    {0x3708, {0x74, 0x74, 0x74, 0x74, 0x74, 0x74}},
    {0x3709, {0x40, 0x40, 0x40, 0x40, 0x40, 0x40}},
    {0x370a, {0x33, 0x33, 0x31, 0x33, 0x33, 0x31}},
    {0x370b, {0x33, 0x33, 0x33, 0x33, 0x33, 0x33}},
    {0x370c, {0x8a, 0x8a, 0x8a, 0x8a, 0x8a, 0x8a}},
    {0x370d, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x370e, {0x28, 0x28, 0x28, 0x28, 0x28, 0x28}},
    {0x370f, {0x3b, 0x3b, 0x3b, 0x3b, 0x3b, 0x3b}},
    {0x3710, {0x21, 0x21, 0x21, 0x21, 0x21, 0x21}},
    {0x3711, {0x15, 0x15, 0x15, 0x15, 0x15, 0x15}},
    {0x3712, {0x19, 0x19, 0x19, 0x19, 0x19, 0x19}},
    {0x3714, {0x42, 0x42, 0x42, 0x42, 0x42, 0x42}},
    {0x3730, {0x01, 0x01, 0x01, 0x01, 0x01, 0x01}},
    {0x3731, {0x6e, 0x6e, 0x6e, 0x6e, 0x6e, 0x6e}},
    {0x3732, {0x01, 0x01, 0x01, 0x01, 0x01, 0x01}},
    {0x3733, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x3738, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x3739, {0x19, 0x19, 0x19, 0x19, 0x19, 0x19}},
    {0x373a, {0x01, 0x01, 0x01, 0x01, 0x01, 0x01}},
    {0x373b, {0xe6, 0xe6, 0xe6, 0xe6, 0xe6, 0xe6}},
    {0x373d, {0xa3, 0xa3, 0xa3, 0xa3, 0xa3, 0xa3}},
    {0x373e, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x373f, {0x70, 0x70, 0x70, 0x70, 0x70, 0x70}},
    {0x3740, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}},
    {0x3741, {0x33, 0x33, 0x33, 0x33, 0x33, 0x33}},
    {0x3742, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x3743, {0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8}},
    {0x3748, {0xa5, 0xa5, 0xa5, 0xa5, 0xa5, 0xa5}},
    {0x374c, {0x88, 0x88, 0x88, 0x88, 0x88, 0x88}},
    {0x3800, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}, //X_start[11:8]
    {0x3801, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}, //X_start[7:0]
    {0x3802, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}, //Y_start[11:8]
    {0x3803, {0x08, 0x08, 0x00, 0x08, 0x08, 0x00}}, //Y_start[7:0]
    {0x3804, {0x10, 0x10, 0x10, 0x10, 0x10, 0x10}}, //X_end[11:8]
    {0x3805, {0xff, 0xff, 0xff, 0xff, 0xff, 0xff}}, //x_end[7:0]
    {0x3806, {0x09, 0x09, 0x09, 0x09, 0x09, 0x09}}, //Y_end[11:8]
    {0x3807, {0x97, 0x97, 0x9f, 0x97, 0x97, 0x9f}}, //Y_end[7:0]
    {0x3808, {0x08, 0x08, 0x10, 0x08, 0x08, 0x10}}, //X_OutputSize[15:8]
    {0x3809, {0x78, 0x78, 0xf0, 0x78, 0x78, 0xf0}}, //X_OutputSize[7:0]
    {0x380a, {0x04, 0x04, 0x09, 0x04, 0x04, 0x09}}, //Y_OutputSize[15:8]
    {0x380b, {0xc4, 0xc4, 0x88, 0xc4, 0xc4, 0x88}}, //Y_OutputSize[7:0]
    {0x380c, {0x15, 0x15, 0x15, 0x15, 0x15, 0x15}}, //HTS[15:8]
    {0x380d, {0x80, 0x80, 0x80, 0x80, 0x80, 0x80}}, //HTS[7:0]
    {0x380e, {0x09, 0x04, 0x09, 0x0b, 0x05, 0x0b}}, //VTS[15:8]
    {0x380f, {0xe0, 0xf0, 0xe0, 0xda, 0xed, 0xda}}, //VTS[7:0]
    {0x3810, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}}, //ISP_X_WIN_Offset[15:8]
    {0x3811, {0x04, 0x04, 0x08, 0x04, 0x04, 0x08}}, //ISP_X_WIN_Offset[7:0]
    {0x3813, {0x02, 0x02, 0x0c, 0x02, 0x02, 0x0c}}, //ISP_Y_WIN_Offset[7:0]
    {0x3815, {0x31, 0x31, 0x11, 0x31, 0x31, 0x11}}, //Y_INC
    {0x3820, {0x02, 0x02, 0x00, 0x02, 0x02, 0x00}},
    {0x3834, {0x01, 0x01, 0x00, 0x01, 0x01, 0x00}},
    {0x4001, {0x00, 0x00, 0x00, 0x00, 0x00, 0x00}},
    {0x4003, {0x1c, 0x1c, 0x30, 0x1c, 0x1c, 0x30}},
    {0x402a, {0x0a, 0x0a, 0x0c, 0x0a, 0x0a, 0x0c}},
    {0x402b, {0x06, 0x06, 0x08, 0x06, 0x06, 0x08}},
    {0x402e, {0x14, 0x14, 0x1c, 0x14, 0x14, 0x1c}},
    {0x4837, {0x12, 0x12, 0x12, 0x12, 0x12, 0x12}},
    {0x5b04, {0x02, 0x02, 0x02, 0x02, 0x02, 0x02}},
    {0x5001, {0x03, 0x03, 0x03, 0x03, 0x03, 0x03}}, // Enable WB gain
};

const AMBA_SENSOR_OUTPUT_INFO_s OV10823OutputInfo[] = {
    {862771766, 4, 10, AMBA_DSP_BAYER_BG, {AMBA_DSP_PHASE_SHIFT_MODE_0, AMBA_DSP_PHASE_SHIFT_MODE_0}, 2168, 1220, { 4,   2, 2160, 1215}, {0}},  /* Output Mode 0     */
    {862771766, 4, 10, AMBA_DSP_BAYER_BG, {AMBA_DSP_PHASE_SHIFT_MODE_0, AMBA_DSP_PHASE_SHIFT_MODE_0}, 4336, 2440, { 8,   4, 4320, 2430}, {0}},  /* Output Mode 1     */

    {863741875, 4, 10, AMBA_DSP_BAYER_BG, {AMBA_DSP_PHASE_SHIFT_MODE_0, AMBA_DSP_PHASE_SHIFT_MODE_0}, 2168, 1220, { 4,   2, 2160, 1215}, {0}},  /* Output Mode 0     */
    {863741875, 4, 10, AMBA_DSP_BAYER_BG, {AMBA_DSP_PHASE_SHIFT_MODE_0, AMBA_DSP_PHASE_SHIFT_MODE_0}, 4336, 2440, { 8,   4, 4320, 2430}, {0}},  /* Output Mode 1     */
};

const AMBA_SENSOR_INPUT_INFO_s OV10823InputInfo[] = {
    {{ 0,  8, 4320, 2430}, { AMBA_SENSOR_SUBSAMPLE_TYPE_BINNING, 1, 2}, { AMBA_SENSOR_SUBSAMPLE_TYPE_BINNING, 1, 2}},  /* Input Mode 0     */
    {{ 0,  0, 4320, 2430}, { AMBA_SENSOR_SUBSAMPLE_TYPE_NORMAL,  1, 1}, { AMBA_SENSOR_SUBSAMPLE_TYPE_NORMAL,  1, 1}},  /* Input Mode 1     */
};

const OV10823_MODE_INFO_s OV10823ModeInfoList[AMBA_SENSOR_OV10823_NUM_MODE] = {
    {    OV10823_S1_10_2168_1220_30P,     OV10823_INPUT_MODE_0,     OV10823_OUTPUT_MODE_0,  23965882,  4555,   2528,  { .Interlace = 0, .TimeScale = 30000, .NumUnitsInTick = 1001 }},  /* Mode  0 */
    {    OV10823_S1_10_2168_1220_60P,     OV10823_INPUT_MODE_0,     OV10823_OUTPUT_MODE_0,  23965882,  4555,   1264,  { .Interlace = 0, .TimeScale = 60000, .NumUnitsInTick = 1001 }},  /* Mode  1 */
    {    OV10823_S1_10_4336_2440_30P,     OV10823_INPUT_MODE_1,     OV10823_OUTPUT_MODE_1,  23965882,  4555,   2528,  { .Interlace = 0, .TimeScale = 30000, .NumUnitsInTick = 1001 }},  /* Mode  2 */

    {    OV10823_S1_10_2168_1220_25P,     OV10823_INPUT_MODE_0,     OV10823_OUTPUT_MODE_2,  23992830,  4555,   3034,  { .Interlace = 0, .TimeScale = 25, .NumUnitsInTick = 1 }},  /* Mode  0 */
    {    OV10823_S1_10_2168_1220_50P,     OV10823_INPUT_MODE_0,     OV10823_OUTPUT_MODE_2,  23992830,  4555,   1517,  { .Interlace = 0, .TimeScale = 50, .NumUnitsInTick = 1 }},  /* Mode  1 */
    {    OV10823_S1_10_4336_2440_25P,     OV10823_INPUT_MODE_1,     OV10823_OUTPUT_MODE_3,  23992830,  4555,   3034,  { .Interlace = 0, .TimeScale = 25, .NumUnitsInTick = 1 }},  /* Mode  2 */
};
